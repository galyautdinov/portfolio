<!DOCTYPE html>
<html>
<head>
    <title>XSLT Tester</title>
    <script>
        function transformXML() {
            const xmlFile = document.getElementById('xmlFile').files[0];
            const xsltFile = document.getElementById('xsltFile').files[0];
            
            if (!xmlFile || !xsltFile) {
                alert('Please select both XML and XSLT files');
                return;
            }

            const xmlReader = new FileReader();
            const xsltReader = new FileReader();

            xmlReader.onload = function(e) {
                const xmlContent = e.target.result;
                xsltReader.onload = function(e) {
                    const xsltContent = e.target.result;
                    performTransformation(xmlContent, xsltContent);
                };
                xsltReader.readAsText(xsltFile);
            };
            xmlReader.readAsText(xmlFile);
        }

        function performTransformation(xmlContent, xsltContent) {
            try {
                // Создаем парсеры
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlContent, 'text/xml');
                const xsltDoc = parser.parseFromString(xsltContent, 'text/xml');
                
                // Проверяем на ошибки парсинга
                if (xmlDoc.getElementsByTagName('parsererror').length > 0) {
                    throw new Error('XML parsing error: ' + xmlDoc.getElementsByTagName('parsererror')[0].textContent);
                }
                if (xsltDoc.getElementsByTagName('parsererror').length > 0) {
                    throw new Error('XSLT parsing error: ' + xsltDoc.getElementsByTagName('parsererror')[0].textContent);
                }

                // Создаем процессор XSLT
                const processor = new XSLTProcessor();
                processor.importStylesheet(xsltDoc);
                
                // Выполняем преобразование
                const resultDoc = processor.transformToDocument(xmlDoc);
                const serializer = new XMLSerializer();
                const resultXML = serializer.serializeToString(resultDoc);
                
                // Показываем результат
                document.getElementById('result').textContent = resultXML;
                document.getElementById('downloadBtn').style.display = 'block';
                
                // Сохраняем результат для скачивания
                window.transformationResult = resultXML;
                
            } catch (error) {
                document.getElementById('result').textContent = 'Error: ' + error.message;
            }
        }

        function downloadResult() {
            const blob = new Blob([window.transformationResult], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Employees.xml';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</head>
<body>
    <h2>XSLT Transformation Tester</h2>
    <div>
        <label>XML File: </label>
        <input type="file" id="xmlFile" accept=".xml"/>
    </div>
    <div>
        <label>XSLT File: </label>
        <input type="file" id="xsltFile" accept=".xslt,.xsl"/>
    </div>
    <button onclick="transformXML()">Transform</button>
    <button id="downloadBtn" onclick="downloadResult()" style="display:none">Download Result</button>
    
    <h3>Result:</h3>
    <pre id="result" style="border:1px solid #ccc; padding:10px; height:300px; overflow:auto"></pre>
</body>
</html>